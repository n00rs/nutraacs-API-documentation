<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Integration Settings & Scheduler Documentation</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #111827;
      --muted: #9ca3af;
      --accent: #7c3aed;
      --glass: rgba(255,255,255,0.03);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
    }
    
    body {
      font-family: Inter, system-ui, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(180deg, #071025 0%, #081224 100%);
      color: #e6eef8;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 28px;
    }
    
    header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 30px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    h1 {
      font-size: 32px;
      margin: 0 0 8px;
      background: linear-gradient(90deg, #7c3aed, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .lead {
      color: var(--muted);
      font-size: 18px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .card {
      background: var(--card);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: 0 10px 25px rgba(2,6,23,0.5);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(2,6,23,0.7);
      border-color: rgba(124, 58, 237, 0.3);
    }
    
    .card h2 {
      margin-top: 0;
      color: #c4b5fd;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card h2 svg {
      width: 24px;
      height: 24px;
      fill: #8b5cf6;
    }
    
    pre {
      background: var(--glass);
      padding: 16px;
      border-radius: 8px;
      overflow: auto;
      font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
      margin: 15px 0;
      border-left: 3px solid var(--accent);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background: var(--glass);
      border-radius: 8px;
      overflow: hidden;
    }
    
    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      text-align: left;
    }
    
    th {
      background: rgba(124, 58, 237, 0.1);
      color: #a78bfa;
      font-weight: 600;
    }
    
    tr:hover {
      background: rgba(124, 58, 237, 0.05);
    }
    
    .note {
      background: linear-gradient(90deg, rgba(124, 58, 237, 0.1), transparent);
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid var(--accent);
      color: var(--muted);
      margin: 20px 0;
    }
    
    .flex {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin: 25px 0;
    }
    
    .flex-item {
      flex: 1;
      min-width: 300px;
    }
    
    .section {
      margin-bottom: 50px;
    }
    
    .section h2 {
      font-size: 26px;
      margin-bottom: 20px;
      color: #a78bfa;
      border-bottom: 1px solid rgba(124, 58, 237, 0.3);
      padding-bottom: 10px;
    }
    
    .badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin: 0 5px 5px 0;
    }
    
    .badge-primary {
      background: rgba(124, 58, 237, 0.2);
      color: #8b5cf6;
    }
    
    .badge-success {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }
    
    .badge-warning {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }
    
    .badge-danger {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }
    
    .diagram-container {
      background: var(--glass);
      padding: 20px;
      border-radius: 10px;
      margin: 25px 0;
      text-align: center;
    }
    
    .steps {
      counter-reset: step-counter;
      margin: 25px 0;
    }
    
    .step {
      position: relative;
      padding-left: 50px;
      margin-bottom: 30px;
    }
    
    .step::before {
      counter-increment: step-counter;
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0;
      width: 36px;
      height: 36px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
    }
    
    .example {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: 20px;
      margin: 25px 0;
      border-left: 4px solid var(--accent);
    }
    
    footer {
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    
    a {
      color: #8b5cf6;
      text-decoration: none;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    .code-block {
      background: var(--glass);
      padding: 16px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.5;
      margin: 15px 0;
      overflow-x: auto;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 20px;
        margin: 20px auto;
      }
      
      .flex {
        flex-direction: column;
      }
      
      .card {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Integration Settings & Scheduler Documentation</h1>
      <p class="lead">Comprehensive guide to setting up and managing scheduled API integrations with payload transformation capabilities</p>
    </header>

    <div class="cards">
      <div class="card">
        <h2>
          <svg viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
          </svg>
          Core Functionality
        </h2>
        <p>Automate API calls and operations at specified frequencies using a robust scheduling system with validation and error handling.</p>
      </div>
      
      <div class="card">
        <h2>
          <svg viewBox="0 0 24 24">
            <path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/>
          </svg>
          Scheduler Entity
        </h2>
        <p>Validates input parameters and encapsulates scheduling configuration with strict validation rules.</p>
      </div>
      
      <div class="card">
        <h2>
          <svg viewBox="0 0 24 24">
            <path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
          </svg>
          Scheduler Service
        </h2>
        <p>Manages job execution using node-schedule with support for multiple frequencies and timezones.</p>
      </div>
    </div>

    <div class="section">
      <h2>System Overview</h2>
      <div class="diagram-container">
        <pre>graph TD
  A[UI Configuration] --> B[Create Integration Settings]
  B --> C{Enable Scheduling?}
  C -->|Yes| D[Configure Frequency]
  D --> E[Set Time Parameters]
  E --> F[Define Payload Transformation]
  F --> G[Save Configuration]
  G --> H[Scheduler Entity Validation]
  H --> I[Scheduler Service Execution]</pre>
      </div>
      <p>The integration settings system allows scheduling automated API calls or operations at specified frequencies. The scheduler entity validates input parameters while the scheduler service manages job execution using <span class="badge badge-primary">node-schedule</span>.</p>
    </div>

    <div class="section">
      <h2>Scheduler Entity</h2>
      <p>Validates and encapsulates scheduling parameters with strict rules for frequency and time formats.</p>
      
      <div class="flex">
        <div class="flex-item">
          <h3>Validation Rules</h3>
          <div class="diagram-container">
            <pre>flowchart TD
  A[Start Validation] --> B{Valid frequency?}
  B -->|No| C[Add INVALID_FREQUENCY error]
  B -->|Yes| D{Frequency != hourly?}
  D -->|Yes| E{Valid time format?}
  E -->|No| F[Add INVALID_TIME_FORMAT error]
  F --> G[Throw errors]
  E -->|Yes| G
  D -->|No| G</pre>
          </div>
        </div>
        
        <div class="flex-item">
          <h3>Parameters</h3>
          <table>
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="badge badge-primary">strFrequency</span></td>
                <td>string</td>
                <td>Frequency of execution (hourly, daily, weekly, monthly)</td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">strTime</span></td>
                <td>string</td>
                <td>Execution time in HH:MM format</td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">strWeekDay</span></td>
                <td>string</td>
                <td>Weekday name for weekly schedules</td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">strTimezone</span></td>
                <td>string</td>
                <td>Timezone for execution (default: UTC)</td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">strFunctionality</span></td>
                <td>string</td>
                <td>Function to execute</td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">objFunctionalityPayload</span></td>
                <td>object</td>
                <td>Payload for the scheduled function</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Scheduler Service</h2>
      <p>Manages job scheduling and execution using node-schedule with robust error handling.</p>
      
      <div class="flex">
        <div class="flex-item">
          <h3>Job Creation Flow</h3>
          <div class="diagram-container">
            <pre>sequenceDiagram
  participant Client
  participant SchedulerService
  participant node-schedule
  
  Client->>SchedulerService: scheduleTask(scheduleConfig)
  SchedulerService->>SchedulerService: Generate job ID
  SchedulerService->>SchedulerService: Parse time parameters
  SchedulerService->>SchedulerService: Create recurrence rule
  alt Weekly schedule
      SchedulerService->>SchedulerService: Map weekday to number
  else Monthly schedule
      SchedulerService->>SchedulerService: Validate day of month (1-31)
  end
  SchedulerService->>node-schedule: scheduleJob(rule, callback)
  node-schedule-->>SchedulerService: Job reference
  SchedulerService->>SchedulerService: Store job in map
  SchedulerService-->>Client: Return job ID</pre>
          </div>
        </div>
        
        <div class="flex-item">
          <h3>Frequency Handling</h3>
          <table>
            <thead>
              <tr>
                <th>Frequency</th>
                <th>Parameters</th>
                <th>Configuration</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="badge badge-primary">Hourly</span></td>
                <td>Minute</td>
                <td><code>objRule.minute = [minute]</code></td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">Daily</span></td>
                <td>Hour + Minute</td>
                <td><code>objRule.hour = [hour]</code><br><code>objRule.minute = [minute]</code></td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">Weekly</span></td>
                <td>Day + Hour + Minute</td>
                <td>Map weekday to number (sunday:0, monday:1, etc)</td>
              </tr>
              <tr>
                <td><span class="badge badge-primary">Monthly</span></td>
                <td>Date + Hour + Minute</td>
                <td><code>objRule.date = [date]</code> (1-31)</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>UI Configuration Procedure</h2>
      
      <div class="steps">
        <div class="step">
          <h3>Create Integration Settings</h3>
          <p>Configure all required parameters including API endpoints, authentication, and data mappings.</p>
        </div>
        
        <div class="step">
          <h3>Enable Scheduling</h3>
          <p>Check "Schedule API call" option to enable automated execution.</p>
        </div>
        
        <div class="step">
          <h3>Client Selection</h3>
          <p>Choose target client/system and set schedule frequency (hourly, daily, weekly, monthly).</p>
        </div>
        
        <div class="step">
          <h3>Time Configuration</h3>
          <p>Set execution time based on frequency:</p>
          <ul>
            <li><span class="badge badge-primary">Hourly</span>: Minute of the hour</li>
            <li><span class="badge badge-primary">Daily</span>: Specific time (HH:MM)</li>
            <li><span class="badge badge-primary">Weekly</span>: Day + time</li>
            <li><span class="badge badge-primary">Monthly</span>: Date + time</li>
          </ul>
        </div>
        
        <div class="step">
          <h3>Payload Transformation</h3>
          <p>Write transformation script to process data:</p>
          <div class="code-block">
            // Example transformation script
            (input) => ({
              processed: input.data.map(item => ({
                id: item.id,
                value: item.value * conversionRate
              })
            })
          </div>
          <p>Validate script functionality before saving.</p>
        </div>
        
        <div class="step">
          <h3>Finalize Configuration</h3>
          <p>Save settings and verify scheduler entity validation. Confirm job creation in scheduler service.</p>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Example: Weekly Integration</h2>
      
      <div class="diagram-container">
        <pre>graph LR
  A[Monday 03:00 UTC] --> B[Execute Integration]
  B --> C[Fetch Source Data]
  C --> D[Transform Payload]
  D --> E[Push to Destination]
  E --> F[Log Results]
  F --> G[Send Notification]</pre>
      </div>
      
      <div class="example">
        <h3>Configuration Parameters</h3>
        <pre>{
  strFrequency: "weekly",
  strTime: "03:00",
  strWeekDay: "monday",
  strTimezone: "UTC",
  strFunctionality: "INTEGRATION_SETTINGS",
  objFunctionalityPayload: {
    source: "CRM_API",
    destination: "ANALYTICS_DB",
    transformation: "crm_to_analytics_v2"
  }
}</pre>
      </div>
    </div>

    <div class="section">
      <h2>Monitoring & Troubleshooting</h2>
      
      <div class="flex">
        <div class="flex-item">
          <h3>Key Metrics</h3>
          <ul>
            <li>Job execution success rate</li>
            <li>Average execution duration</li>
            <li>Payload size trends</li>
            <li>Resource utilization during jobs</li>
            <li>Timeout occurrences</li>
          </ul>
          
          <h3>Common Issues</h3>
          <table>
            <thead>
              <tr>
                <th>Issue</th>
                <th>Resolution</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Missed Executions</td>
                <td>Verify timezone configuration and server clock</td>
              </tr>
              <tr>
                <td>Payload Failures</td>
                <td>Test transformation scripts independently</td>
              </tr>
              <tr>
                <td>Data Mismatches</td>
                <td>Validate input/output schemas</td>
              </tr>
              <tr>
                <td>API Rate Limits</td>
                <td>Implement exponential backoff retries</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="flex-item">
          <h3>Error Codes</h3>
          <table>
            <thead>
              <tr>
                <th>Code</th>
                <th>Description</th>
                <th>Severity</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>INVALID_FREQUENCY</td>
                <td>Unsupported frequency value</td>
                <td><span class="badge badge-danger">High</span></td>
              </tr>
              <tr>
                <td>INVALID_TIME_FORMAT</td>
                <td>Incorrect time format</td>
                <td><span class="badge badge-danger">High</span></td>
              </tr>
              <tr>
                <td>INVALID_DAY_OF_MONTH</td>
                <td>Invalid date for monthly schedule</td>
                <td><span class="badge badge-danger">High</span></td>
              </tr>
              <tr>
                <td>TRANSFORM_ERROR</td>
                <td>Payload transformation failure</td>
                <td><span class="badge badge-warning">Medium</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <footer>
      <p>Integration Settings & Scheduler Documentation | Version 2.1.0</p>
      <p>Â© 2023 Integration Platform. All rights reserved.</p>
    </footer>
  </div>
</body>
</html>