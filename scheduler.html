<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Settings & Scheduler Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f72585;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: var(--light);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(67, 97, 238, 0.1) 0%, transparent 70%);
            z-index: -1;
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #4361ee, #4cc9f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.4rem;
            max-width: 800px;
            margin: 0 auto 25px;
            color: #c0c0c0;
        }
        
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .card {
            background: rgba(30, 30, 40, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(67, 97, 238, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(67, 97, 238, 0.4);
            border-color: rgba(67, 97, 238, 0.6);
        }
        
        .card h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h2 i {
            background: rgba(67, 97, 238, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .section {
            background: rgba(30, 30, 40, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(67, 97, 238, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .section h2 {
            color: var(--accent);
            margin-bottom: 25px;
            font-size: 2.2rem;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
        }
        
        .mermaid {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            background: rgba(67, 97, 238, 0.3);
            color: var(--accent);
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            border-left: 4px solid var(--accent);
        }
        
        .highlight {
            color: var(--accent);
            font-weight: bold;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            margin: 0 5px;
        }
        
        .badge-success {
            background: rgba(76, 201, 240, 0.2);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(247, 37, 133, 0.2);
            color: var(--warning);
        }
        
        .flex {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .flex-item {
            flex: 1;
            min-width: 300px;
        }
        
        .steps {
            counter-reset: step-counter;
            margin: 25px 0;
        }
        
        .step {
            position: relative;
            padding-left: 60px;
            margin-bottom: 30px;
        }
        
        .step::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .example {
            background: rgba(0, 0, 0, 0.25);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid var(--accent);
        }
        
        footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            color: #aaa;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Integration Settings & Scheduler Documentation</h1>
            <p class="subtitle">Comprehensive guide to setting up and managing scheduled API integrations with payload transformation capabilities</p>
        </header>
        
        <div class="cards">
            <div class="card">
                <h2><i>✓</i> Core Functionality</h2>
                <p>Automate API calls and operations at specified frequencies using a robust scheduling system with validation and error handling.</p>
            </div>
            <div class="card">
                <h2><i>⚙️</i> Scheduler Entity</h2>
                <p>Validates input parameters and encapsulates scheduling configuration with strict validation rules.</p>
            </div>
            <div class="card">
                <h2><i>⏱️</i> Scheduler Service</h2>
                <p>Manages job execution using node-schedule with support for multiple frequencies and timezones.</p>
            </div>
        </div>
        
        <div class="section">
            <h2>System Overview</h2>
            <div class="mermaid">
                graph TD
                    A[UI Configuration] --> B[Create Integration Settings]
                    B --> C{Enable Scheduling?}
                    C -->|Yes| D[Configure Frequency]
                    D --> E[Set Time Parameters]
                    E --> F[Define Payload Transformation]
                    F --> G[Save Configuration]
                    G --> H[Scheduler Entity Validation]
                    H --> I[Scheduler Service Execution]
            </div>
            
            <p>The integration settings system allows scheduling automated API calls or operations at specified frequencies. The scheduler entity validates input parameters while the scheduler service manages job execution using <span class="highlight">node-schedule</span>.</p>
        </div>
        
        <div class="section">
            <h2>Scheduler Entity</h2>
            <p>Validates and encapsulates scheduling parameters with strict rules for frequency and time formats.</p>
            
            <div class="grid-2">
                <div>
                    <h3>Validation Rules</h3>
                    <div class="mermaid">
                        flowchart TD
                            A[Start Validation] --> B{Valid frequency?}
                            B -->|No| C[Add INVALID_FREQUENCY error]
                            B -->|Yes| D{Frequency != hourly?}
                            D -->|Yes| E{Valid time format?}
                            E -->|No| F[Add INVALID_TIME_FORMAT error]
                            F --> G[Throw errors]
                            E -->|Yes| G
                            D -->|No| G
                    </div>
                </div>
                
                <div>
                    <h3>Parameters</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="highlight">strFrequency</span></td>
                                <td>string</td>
                                <td>Frequency of execution (hourly, daily, weekly, monthly)</td>
                            </tr>
                            <tr>
                                <td><span class="highlight">strTime</span></td>
                                <td>string</td>
                                <td>Execution time in HH:MM format</td>
                            </tr>
                            <tr>
                                <td><span class="highlight">strWeekDay</span></td>
                                <td>string</td>
                                <td>Weekday name for weekly schedules</td>
                            </tr>
                            <tr>
                                <td><span class="highlight">strTimezone</span></td>
                                <td>string</td>
                                <td>Timezone for execution (default: UTC)</td>
                            </tr>
                            <tr>
                                <td><span class="highlight">strFunctionality</span></td>
                                <td>string</td>
                                <td>Function to execute</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Scheduler Service</h2>
            <p>Manages job scheduling and execution using node-schedule with robust error handling.</p>
            
            <div class="grid-2">
                <div>
                    <h3>Job Creation Flow</h3>
                    <div class="mermaid">
                        sequenceDiagram
                            participant Client
                            participant SchedulerService
                            participant node-schedule
                            
                            Client->>SchedulerService: scheduleTask(scheduleConfig)
                            SchedulerService->>SchedulerService: Generate job ID
                            SchedulerService->>SchedulerService: Parse time parameters
                            SchedulerService->>SchedulerService: Create recurrence rule
                            alt Weekly schedule
                                SchedulerService->>SchedulerService: Map weekday to number
                            else Monthly schedule
                                SchedulerService->>SchedulerService: Validate day of month (1-31)
                            end
                            SchedulerService->>node-schedule: scheduleJob(rule, callback)
                            node-schedule-->>SchedulerService: Job reference
                            SchedulerService->>SchedulerService: Store job in map
                            SchedulerService-->>Client: Return job ID
                    </div>
                </div>
                
                <div>
                    <h3>Frequency Handling</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Frequency</th>
                                <th>Parameters</th>
                                <th>Configuration</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="highlight">Hourly</span></td>
                                <td>Minute</td>
                                <td>objRule.minute = [minute]</td>
                            </tr>
                            <tr>
                                <td><span class="highlight">Daily</span></td>
                                <td>Hour + Minute</td>
                                <td>objRule.hour = [hour], objRule.minute = [minute]</td>
                            </tr>
                            <tr>
                                <td><span class="highlight">Weekly</span></td>
                                <td>Day + Hour + Minute</td>
                                <td>Map weekday to number (sunday:0, monday:1, etc)</td>
                            </tr>
                            <tr>
                                <td><span class="highlight">Monthly</span></td>
                                <td>Date + Hour + Minute</td>
                                <td>objRule.date = [date] (1-31)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>UI Configuration Procedure</h2>
            
            <div class="steps">
                <div class="step">
                    <h3>Create Integration Settings</h3>
                    <p>Configure all required parameters including API endpoints, authentication, and data mappings.</p>
                </div>
                
                <div class="step">
                    <h3>Enable Scheduling</h3>
                    <p>Check "Schedule API call" option to enable automated execution.</p>
                </div>
                
                <div class="step">
                    <h3>Client Selection</h3>
                    <p>Choose target client/system and set schedule frequency (hourly, daily, weekly, monthly).</p>
                </div>
                
                <div class="step">
                    <h3>Time Configuration</h3>
                    <p>Set execution time based on frequency:</p>
                    <ul>
                        <li><span class="highlight">Hourly</span>: Minute of the hour</li>
                        <li><span class="highlight">Daily</span>: Specific time (HH:MM)</li>
                        <li><span class="highlight">Weekly</span>: Day + time</li>
                        <li><span class="highlight">Monthly</span>: Date + time</li>
                    </ul>
                </div>
                
                <div class="step">
                    <h3>Payload Transformation</h3>
                    <p>Write transformation script to process data:</p>
                    <div class="code-block">
                        // Example transformation script
                        (input) => ({
                            processed: input.data.map(item => ({
                                id: item.id,
                                value: item.value * conversionRate
                            }))
                        })
                    </div>
                    <p>Validate script functionality before saving.</p>
                </div>
                
                <div class="step">
                    <h3>Finalize Configuration</h3>
                    <p>Save settings and verify scheduler entity validation. Confirm job creation in scheduler service.</p>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Example: Weekly Integration</h2>
            
            <div class="mermaid">
                graph LR
                    A[Monday 03:00 UTC] --> B[Execute Integration]
                    B --> C[Fetch Source Data]
                    C --> D[Transform Payload]
                    D --> E[Push to Destination]
                    E --> F[Log Results]
                    F --> G[Send Notification]
            </div>
            
            <div class="example">
                <h3>Configuration Parameters</h3>
                <div class="code-block">
{
  strFrequency: "weekly",
  strTime: "03:00",
  strWeekDay: "monday",
  strTimezone: "UTC",
  strFunctionality: "INTEGRATION_SETTINGS",
  objFunctionalityPayload: {
    source: "CRM_API",
    destination: "ANALYTICS_DB",
    transformation: "crm_to_analytics_v2"
  }
}
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Monitoring & Troubleshooting</h2>
            
            <div class="grid-2">
                <div>
                    <h3>Key Metrics</h3>
                    <ul>
                        <li>Job execution success rate</li>
                        <li>Average execution duration</li>
                        <li>Payload size trends</li>
                        <li>Resource utilization during jobs</li>
                        <li>Timeout occurrences</li>
                    </ul>
                    
                    <h3>Common Issues</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Issue</th>
                                <th>Resolution</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Missed Executions</td>
                                <td>Verify timezone configuration and server clock</td>
                            </tr>
                            <tr>
                                <td>Payload Failures</td>
                                <td>Test transformation scripts independently</td>
                            </tr>
                            <tr>
                                <td>Data Mismatches</td>
                                <td>Validate input/output schemas</td>
                            </tr>
                            <tr>
                                <td>API Rate Limits</td>
                                <td>Implement exponential backoff retries</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div>
                    <h3>Error Codes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Description</th>
                                <th>Severity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>INVALID_FREQUENCY</td>
                                <td>Unsupported frequency value</td>
                                <td><span class="badge badge-warning">High</span></td>
                            </tr>
                            <tr>
                                <td>INVALID_TIME_FORMAT</td>
                                <td>Incorrect time format</td>
                                <td><span class="badge badge-warning">High</span></td>
                            </tr>
                            <tr>
                                <td>INVALID_DAY_OF_MONTH</td>
                                <td>Invalid date for monthly schedule</td>
                                <td><span class="badge badge-warning">High</span></td>
                            </tr>
                            <tr>
                                <td>TRANSFORM_ERROR</td>
                                <td>Payload transformation failure</td>
                                <td><span class="badge badge-warning">Medium</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Integration Settings & Scheduler Documentation | Version 2.1.0</p>
            <p>© 2023 Integration Platform. All rights reserved.</p>
        </footer>
    </div>
</body>
</html>